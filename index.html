<!DOCTYPE html>
<html   超文本标记语言 lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极速画廊 · CDN加速版</title>
    <style>
        :root {
            --bg-color: #080808;
            --card-bg: #111;
            --speed: 0.8; 
        }

        body, html { margin: 0; padding: 0; background: var(--bg-color); overflow: hidden; font-family: sans-serif; }

        #scroll-wrapper { position: absolute; width: 100%; top: 0; left: 0; will-change: transform; }

        .gallery-container {
            column-count: 3; column-gap: 15px; padding: 15px; max-width: 1400px; margin: 0 auto;
        }

        @media (max-width: 900px) { .gallery-container { column-count: 2; } }
        @media (max-width: 600px) { .gallery-container { column-count: 1; } }

        .img-card {
            break-inside: avoid; margin-bottom: 15px; border-radius: 10px;
            background: var(--card-bg); overflow: hidden;
            min-height: 100px; /* 预留高度防止跳动 */
        }

        .img-card img {
            width: 100%; height: auto; display: block;
            opacity: 0; transform: translateY(10px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        .img-card img.loaded { opacity: 1; transform: translateY(0); }

        .loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); display: flex; justify-content: center; align-items: center;
            color: #666; z-index: 100; transition: opacity 0.5s;
        }
    </style>
</head>
<body>

<div id="loading-screen" class="loading-screen">极速同步中...</div>

<div id="scroll-wrapper">
    <div id="g1" class="gallery-container"></div>
    <div id="g2" class="gallery-container"></div>
</div>

<script>
    const CONFIG = {
        username: 'wokao66', 
        repo: 'KELLY',
        speed: 0.8    速度:0.8
    };

    // 使用 jsDelivr CDN 加速图片链接
    const CDN_PREFIX = `https://cdn.jsdelivr.net/gh/${CONFIG.username}/${CONFIG.repo}`;

    let currentY = 0;
    let isPaused = false;
    const wrapper = document.getElementById('scroll-wrapper');

    async function init() {
        try {
            // 1. 获取根目录列表
            const res = await fetch(`https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/`);
            const items = await res.json();
            const folders = items.filter(i => i.type === 'dir' && !i.name.startsWith('.'));

            // 2. 并发读取所有文件夹（速度更快）
            const allFolderPromises = folders.map(f => fetch(f.url).then(r => r.json()));
            const folderContents = await Promise.all(allFolderPromises);

            let imageUrls = [];
            folderContents.forEach((files, index) => {
                const folderName = folders[index].name;
                const webps = files
                    .filter   过滤器   过滤器(x => x.name   名字   名字.toLowerCase().endsWith('.webp'))
                    .map   地图(x => `${CDN_PREFIX}/${folderName}/${x.name   名字}`); // 核心：转为CDN地址
                imageUrls = [...imageUrls, ...webps];
            });

            if   如果 (imageUrls.length   长度 === 0) {
                document.getElementById('loading-screen').innerText = "未发现WebP图片";
                return;   返回;
            }

            render(imageUrls);   体式(imageUrls);
            
            document.getElementById('loading-screen').style.opacity = '0';.style   风格 . getelementbyid(“加载”)。不透明度= '0'；
            setTimeout(() => document.getElementById('loading-screen').remove(), 500);setTimeout(() => document   文档.getElementById（   getElementById ('loading-screen'   “加载”）。remove (), 500);

            startScroll();
        } catch (e) {
            document.getElementById('loading-screen').innerText = "加载超时，请刷新重试";
        }
    }

    function render(urls) {   函数渲染（url） {
        // 随机乱序
        urls.sort(() => Math.random() - 0.5);url。sort      url。定的地方url。定的地方() => Math   数学.random   随机() - 0.5)；

        const html = urls.map(url => `Const HTML = url。Map （url = b>）Const HTML = url。map(url => ' Const HTML = url。映射（url = b>）
            <div class="img-card">
                <img src="${url}" onload="this.classList.add('loaded')" loading="lazy">
            </div>
        `).join('');   ”). join   加入 ();
        
        document.getElementById('g1').innerHTML = html;. getelementbyid (g1)。innerHTML = html；   html   超文本标记语言;
        document.getElementById('g2').innerHTML = html;. getelementbyid(“g2”)。innerHTML = html；   html   超文本标记语言;
    }

    function startScroll() {   函数startScroll() {
        function step() {   函数步骤（）{
            if (!isPaused) {   如果(!isPaused) {
                currentY -= CONFIG.speed;   currentY   当前y坐标 -= CONFIG   配置.speed；   速度;
                const h = document.getElementById('g1').offsetHeight;const   常量 h = document   文档.getElementById('g1'   g1的).offsetHeight；   offsetHeight;
                if (Math.abs(currentY) >= h) currentY = 0;如果(数学。abs（当前）>= h)当前= 0；
                wrapper.style.transform = `translate3d(0, ${currentY}px, 0)`;wrapper   包装器.style   风格.transform   变换 = ' translate3d(0, ${currentY}px, 0) '‘ translate3d(0, ${currentY   当前y坐标}px, 0) ’；
            }
            requestAnimationFrame(step);requestAnimationFrame(步骤);
        }
        requestAnimationFrame(step);requestAnimationFrame(步骤);
    }

    wrapper.addEventListener('mouseenter', () => isPaused = true);包装。addEventListener('mouseenter'   “mouseenter”, () => isPaused = true   真正的)；
    wrapper.addEventListener('mouseleave', () => isPaused = false);包装。addEventListener('mouseleave'   “mouseleave”, () => isPaused = false   假)；

    init();
</script>   > < /脚本

</body>   身体< / >
</html   超文本标记语言>
